<beast version='2.0' 
	hidepanes='DATA_PANEL|TIP_DATES_PANEL|OPERATORS_PANEL|CLOCK_MODEL_PANEL'
	namespace='snap:beast.util:beast.core.util:beast.evolution:beast.evolution.alignment:snap.likelihood:beast.core.util:beast.evolution'>

<map name='snapprior'>snap.likelihood.SnAPPrior</map>
<map name='snaptreelikelihood'>snap.likelihood.SnAPTreeLikelihood</map>

    <data id="#alignments"/>

    <plate var='n' range='#alignments'>
            <data spec='snap.Data' id='snapalignment' dataType='integerdata'>
            <rawdata idref='$(n)'/>
        </data>
    </plate>


        <populationModel spec="tree.coalescent.ExponentialGrowth" id="ExponentialGrowth">
            <parameter name="popSize" id="popSize" value='1.0'/>
            <parameter name="growthRate" id="growthRate" value='1.0'/>
        </populationModel>

         <distribution id="coalescent" spec="tree.coalescent.Coalescent">
             <treeIntervals spec='tree.coalescent.TreeIntervals' id='TreeIntervals'>
                  <tree idref="tree"/>
             </treeIntervals>
             <populationModel spec="tree.coalescent.ConstantPopulation" id='ConstantPopulation' popSize='@popSize'/>
         </distribution>

<run id='mcmc' spec='snap.MCMC' chainLength='1000000' preBurnin='0' stateBurnin='0'>
        <state storeEvery='1000'>
          <tree name='stateNode' spec='ClusterTree' id='tree' nodetype='snap.NodeData' clusterType='upgma'>
                <input name='taxa' idref='snapalignment'/>
	            <trait spec='beast.evolution.tree.TraitSet' traitname='date' units='year'
		            value=''>
		            <taxa idref='snapalignment'/>
	            </trait>
          </tree>
          <parameter name='stateNode' id='coalescenceRate' value='10'/>
          <parameter name='stateNode' id='v' value='0.588235' lower='0.0'/>
          <parameter name='stateNode' id='u' value='3.33333' lower='0.0'/>
          <parameter name='stateNode' id='alpha'  value='11.750' lower='0.0'/>
          <parameter name='stateNode' id='beta'   value='109.73' lower='0.0'/>
          <parameter name='stateNode' id='lambda' value='0.00765' lower='0.0'/>
   		  <stateNode idref="birthRate"/>
        </state>

        <distribution id='posterior' spec='beast.core.util.CompoundDistribution'>
             <distribution spec="CompoundDistribution" id="prior">
	             <distribution spec='speciation.BirthDeathGernhard08Model' id="Yule" type='timesonly'>
         	    	 <parameter name='birthDiffRate' id="birthRate" value="1.0" lower="0.0" upper="100.0"/>
                	 <parameter name='relativeDeathRate' id='constantDeathRate' value='1.0'/>
                	 <tree idref='tree'/>
            	 </distribution>
                 <distribution spec='SnAPPrior' name='distribution' id='snapprior'>
                      <input name='alpha' idref='alpha'/>
                      <input name='beta' idref='beta'/>
                      <input name='lambda' idref='lambda'/>
                      <input name='coalescenceRate' idref='coalescenceRate'/>
                          <input name='tree' idref='tree'/>
             </distribution>
        </distribution>
        <distribution id='likelihood' spec='beast.core.util.CompoundDistribution'>
             <snaptreelikelihood name='distribution' id='treeLikelihood' initFromTree='false' pattern='coalescenceRate'>
                <siteModel spec='sitemodel.SiteModel' id="siteModel">
                    <substModel spec='snap.likelihood.SnapSubstitutionModel'>
                        <mutationRateU idref='u'/>
                        <mutationRateV idref='v'/>
            	        <coalescenceRate idref='coalescenceRate'/>
                    </substModel>
                </siteModel>
                <data idref='snapalignment'/>
                <tree idref='tree'/>
            </snaptreelikelihood>
        </distribution>
        </distribution>

        <stateDistribution idref='prior'/>

        <operator spec='operators.NodeSwapper' weight='0.5' tree='@tree'/>
        <operator spec='operators.NodeBudger' weight='0.5' size='0.5' tree='@tree'/>>
        <operator spec='operators.ScaleOperator' scaleFactor='0.25' weight='0.5' tree='@tree'/>>
        <operator spec='operators.GammaMover' scale='0.5' weight='8' coalescenceRate='@coalescenceRate'/>
        <operator spec='operators.RateMixer' scaleFactors='0.25' weight='1' coalescenceRate='@coalescenceRate' tree='@tree' />

        <operator spec='operators.ScaleOperator' scaleFactor="0.75" weight="3" parameter='@birthRate'/>


        <logger logEvery='100' id='screenlog'>
            <model idref='posterior'/>
            <log idref='u'/>
            <log idref='v'/>
            <log idref='prior'/>
            <log idref='likelihood'/>
            <log idref='posterior'/>
            <log spec='beast.evolution.tree.TreeHeightLogger'>
                     <tree idref='tree'/>
            </log>
        </logger>
        <logger logEvery='100' fileName='snap.$(seed).log' id='filelog'>
            <model idref='posterior'/>
            <log idref='u'/>
            <log idref='v'/>
            <log idref='prior'/>
            <log idref='likelihood'/>
            <log idref='posterior'/>
                        <log idref='coalescenceRate'/>
                    <log spec='snap.ThetaLogger'>
                             <coalescenceRate idref='coalescenceRate'/>
                    </log>
            <log spec='beast.evolution.tree.TreeHeightLogger'>
                    <tree idref='tree'/>
            </log>
        </logger>
        <logger logEvery='100' fileName='snap.$(seed).trees' mode='tree'  id='treelog'>  
            <log spec='beast.evolution.tree.TreeWithMetaDataLogger' tree='@tree'>
                <metadata spec='RateToTheta' id='theta' coalescenceRate='@coalescenceRate'/>
            </log>
        </logger>
</run>

</beast>

